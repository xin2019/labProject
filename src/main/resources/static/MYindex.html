<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>OIL_1201</title>

</head>
<body>
<!--input file打开文件选择框，获取文件信息，并传参给readWorkbookFromLocalFile函数-->
<form>
    <input type="file" name="file" onchange="readWorkbookFromLocalFile(this.files[0])" value="选择excel文件"/>
</form>
<!-- 为 ECharts 准备一个定义了宽高的 DOM -->
<div id="main" style="width: 600px;height:400px;"></div>
<script src="./js/echarts.js"></script>
<script src="./js/xlsx.full.min.js"></script>
<script src="./js/jquery.min.js"></script>
<script>
    // 读取本地excel文件
    function readWorkbookFromLocalFile(file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var data = e.target.result;
            var workbook = XLSX.read(data, {type: 'binary'});
            // 处理excel文件
            handle(workbook);
        };
        reader.readAsBinaryString(file);
        //通过FileReader对象读取文件，利用js-xlsx转成json数据
        //FileReader共有4种读取方法：
        //1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。
        //2.readAsBinaryString(file)：将文件读取为二进制字符串
        //3.readAsDataURL(file)：将文件读取为Data URL
        //4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'
    }

    // 处理excel文件

    var date1=[];
    var date2=[];
    function handle(workbook) {
        // workbook.SheetNames[0] excel第一个sheet
        var datas = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        console.log("=====");
        console.log(datas);
        console.log("=====")
        var title = [];
        var curData=[];//存放data中第一列的值
        if (datas.length > 0) {


            // 获取列名是汇总列名，避免某行某个字段没有值，会缺少字段
            // 标题

            // 获取每行数据
            first:
                for (var index in datas) { // datas数组，index为索引
                    console.log("datas[index]====>"+index)
                    second:
                        for (var key in datas[index]) { // datas[index]对象,key为键
                            if (-1 === title.indexOf(key)) {
                                title.push(key);

                            }
                        }
                }
            for(var loop=0;loop<datas.length;loop++){
                // console.log("----------***-----")
                // console.log(datas[loop])
                // console.log("-------------------------")
                // console.log(datas[loop][title[0]])
                // console.log("----------***-----")
                curData.push(datas[loop][title[0]]);
            }

            // 列名
            console.log("lieming===>"+title);
            // 数据
            console.log("数据==》"+datas);

            // //时间转化，并把datas中数据分列
            // for (var i = 0; i < datas.length; i++) {
            //     var a = datas[i].time * 24;
            //     var b = (a - parseInt(a)) * 60;
            //     var c = (b - parseInt(b)) * 60;
            //     date1[i] = parseInt(a).toString() + ":" + parseInt(b).toString() + ":" + parseInt(c).toString();
            //     date2[i] = datas[i].sum;
            // }
            //
            // console.log(date1);
            // console.log(date2);
            var xdata=[];
            for(var loop=0;loop<datas.length;loop++)
                xdata.push(loop+1);
             aaa(xdata,curData);
        }
    }
</script>


<script type="text/javascript">

    function aaa(xdata,ydata) {
        console.log("xdata===>")
        for(var loop=0;loop<xdata.length;loop++)
            console.log(xdata[loop],ydata[loop])
        console.log("xdata===>")
        // var echarts = require('echarts');
        // var echarts = echarts;

        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        option = {
            xAxis: {
                type: 'category',
                data: xdata
                // data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    data: ydata,
                    // data: [820, 932, 901, 934, 1290, 1330, 1320],
                    type: 'line',
                    smooth: true
                }
            ]
        };

        option && myChart.setOption(option);
    }
</script>
</body>
</html>