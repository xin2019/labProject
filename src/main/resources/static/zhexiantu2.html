<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" >
    <head>
        <meta charset="UTF-8">
        <title>1201实验室-石油项目</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
    </head>
    <body>
    <div class="x-body">

        <form>
            <input type="file" class="layui-upload-button" name="file" style="display:inline-block" onchange="readWorkbookFromLocalFile(this.files[0])">
        </form>
        <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
        <div id="main" style="width: 600px; height: 400px; display: inline-block; user-select: none;" _echarts_instance_="ec_1666261576661"><div style="position: relative; width: 600px; height: 400px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;"><canvas style="position: absolute; left: 0px; top: 0px; width: 600px; height: 400px; user-select: none; padding: 0px; margin: 0px; border-width: 0px;" data-zr-dom-id="zr_0" width="600" height="400"></canvas></div></div>
        <div id="main_tips" style="float:right;border-left: 1px solid lightgrey; display:inline-block; width: 480px;height:500px;"><h1><span style="font-size:large;">excel数据格式如下：<p style="color:red">注意：如果是非excel文档，或者excel文档的格式错误则无法显示数据</p></span></h1>
            <img src="./images/zhexiantu.jpg" style="width: 100%;height: 450px;">
        </div>
    </div>

        <script src="./js/echarts.js"></script>
        <script src="./js/xlsx.full.min.js"></script>
        <script src="./js/jquery.min.js"></script>
        <script>
            // 读取本地excel文件
            function readWorkbookFromLocalFile(file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var data = e.target.result;
                    var workbook = XLSX.read(data, {type: 'binary'});
                    // 处理excel文件
                    handle(workbook);
                };
                reader.readAsBinaryString(file);
                //通过FileReader对象读取文件，利用js-xlsx转成json数据
                //FileReader共有4种读取方法：
                //1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。
                //2.readAsBinaryString(file)：将文件读取为二进制字符串
                //3.readAsDataURL(file)：将文件读取为Data URL
                //4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'
            }

            // 处理excel文件

            var date1=[];
            var date2=[];
            function handle(workbook) {
                // workbook.SheetNames[0] excel第一个sheet
                var datas = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                console.log("=====");
                console.log(datas);
                console.log("=====")
                var title = [];
                var curData=[];//存放data中第一列的值
                if (datas.length > 0) {


                    // 获取列名是汇总列名，避免某行某个字段没有值，会缺少字段
                    // 标题

                    // 获取每行数据
                    first:
                        for (var index in datas) { // datas数组，index为索引
                            console.log("datas[index]====>"+index)
                            second:
                                for (var key in datas[index]) { // datas[index]对象,key为键
                                    if (-1 === title.indexOf(key)) {
                                        title.push(key);

                                    }
                                }
                        }
                    for(var loop=0;loop<datas.length;loop++){
                        // console.log("----------***-----")
                        // console.log(datas[loop])
                        // console.log("-------------------------")
                        // console.log(datas[loop][title[0]])
                        // console.log("----------***-----")
                        curData.push(datas[loop][title[0]]);
                    }

                    // 列名
                    console.log("lieming===>"+title);
                    // 数据
                    console.log("数据==》"+datas);

                    // //时间转化，并把datas中数据分列
                    // for (var i = 0; i < datas.length; i++) {
                    //     var a = datas[i].time * 24;
                    //     var b = (a - parseInt(a)) * 60;
                    //     var c = (b - parseInt(b)) * 60;
                    //     date1[i] = parseInt(a).toString() + ":" + parseInt(b).toString() + ":" + parseInt(c).toString();
                    //     date2[i] = datas[i].sum;
                    // }
                    //
                    // console.log(date1);
                    // console.log(date2);
                    var xdata=[];
                    for(var loop=0;loop<datas.length;loop++)
                        xdata.push(loop+1);

                    aaa(xdata,curData,title[0]);
                }
            }
        </script>


        <script type="text/javascript">

            function aaa(xdata,ydata,yname) {
                console.log("title-name=>",yname)
                console.log("xdata===>")
                for(var loop=0;loop<xdata.length;loop++)
                    console.log(xdata[loop],ydata[loop])
                console.log("xdata===>")
                // var echarts = require('echarts');
                // var echarts = echarts;

                var chartDom = document.getElementById('main');
                var myChart = echarts.init(chartDom);
                var option;

                option = {
                    xAxis: {
                        name: '集',
                        type: 'category',
                        data: xdata
                        // data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                    },
                    yAxis: {
                        name: yname,
                        type: 'value'
                    },
                    : [
                        {

                            data: ydata,
                            // data: [820, 932, 901, 934, 1290, 1330, 1320],
                            type: 'line',
                            smooth: true
                        }
                    ]
                };

                option && myChart.setOption(option);
            }
        </script>
    </body>
</html>